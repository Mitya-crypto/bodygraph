# üí≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ YooKassa –¥–ª—è BodyGraph

## üìã –û–±–∑–æ—Ä

YooKassa –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ BodyGraph –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞ –ø—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∏ –∏ —Ä–∞–∑–æ–≤—ã–µ –ø–æ–∫—É–ø–∫–∏.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ YooKassa

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [yookassa.ru](https://yookassa.ru)
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
3. –°–æ–∑–¥–∞–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω)

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ YooKassa –Ω–∞–π–¥–∏—Ç–µ:
- **Shop ID** (ID –º–∞–≥–∞–∑–∏–Ω–∞)
- **Secret Key** (–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `.env.local`:

```bash
# YooKassa Payment Integration
YOOKASSA_SHOP_ID=–≤–∞—à_shop_id_–∑–¥–µ—Å—å
YOOKASSA_SECRET_KEY=–≤–∞—à_secret_key_–∑–¥–µ—Å—å
YOOKASSA_API_URL=https://api.yookassa.ru/v3
YOOKASSA_WEBHOOK_URL=http://localhost:3001/api/yookassa/webhook
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook

–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ YooKassa:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "Webhook"
2. –î–æ–±–∞–≤—å—Ç–µ URL: `https://–≤–∞—à-–¥–æ–º–µ–Ω.com/api/yookassa/webhook`
3. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è:
   - `payment.succeeded` - —É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂
   - `payment.canceled` - –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–π –ø–ª–∞—Ç–µ–∂
   - `payment.waiting_for_capture` - –æ–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

## üí∞ –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–ª–∞–Ω—ã

### –ü–æ–¥–ø–∏—Å–æ—á–Ω—ã–µ –ø–ª–∞–Ω—ã:
- **–ü—Ä–µ–º–∏—É–º (–º–µ—Å—è—Ü)** - 9.90 ‚ÇΩ/–º–µ—Å—è—Ü
- **–ü—Ä–µ–º–∏—É–º (–≥–æ–¥)** - 99.00 ‚ÇΩ/–≥–æ–¥ (—Å–∫–∏–¥–∫–∞ 17%)

### –†–∞–∑–æ–≤—ã–µ –ø–æ–∫—É–ø–∫–∏:
- **–ù—É–º–µ—Ä–æ–ª–æ–≥–∏—è –ø—Ä–µ–º–∏—É–º** - 4.90 ‚ÇΩ
- **Human Design –ø—Ä–µ–º–∏—É–º** - 5.90 ‚ÇΩ
- **–ê—Å—Ç—Ä–æ–ª–æ–≥–∏—è –ø—Ä–µ–º–∏—É–º** - 6.90 ‚ÇΩ

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –ø–ª–∞–Ω –≤ `/subscription`
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø–ª–∞—Ç–µ–∂–∞
3. –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ YooKassa API
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã YooKassa
5. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ `/payment/success`
6. Webhook –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üõ†Ô∏è API Endpoints

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
```
POST /api/yookassa/create-payment
{
  "planId": "premium_monthly",
  "userId": "user123",
  "returnUrl": "https://app.com/payment/success"
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
```
POST /api/yookassa/check-payment
{
  "paymentId": "payment_id_from_yookassa"
}
```

### Webhook –æ—Ç YooKassa
```
POST /api/yookassa/webhook
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã YooKassa:
- **–£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂**: 5555 5555 5555 4477
- **–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–π –ø–ª–∞—Ç–µ–∂**: 5555 5555 5555 4444
- **CVV**: 123
- **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è**: –ª—é–±–∞—è –¥–∞—Ç–∞ –≤ –±—É–¥—É—â–µ–º

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `npm run dev`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/subscription`
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞–Ω –∏ –Ω–∞–∂–º–∏—Ç–µ "–û–ø–ª–∞—Ç–∏—Ç—å"
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ –ø–ª–∞—Ç–µ–∂–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ YooKassa (PCI DSS Level 1)
- –î–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- Webhook –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –∫–æ–¥–µ)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–õ–æ–≥–∏ –ø–ª–∞—Ç–µ–∂–µ–π –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞:
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π
- –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π
- Webhook —Å–æ–±—ã—Ç–∏—è
- –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üöÄ –ü—Ä–æ–¥–∞–∫—à–µ–Ω

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
1. –ó–∞–º–µ–Ω–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ
2. –û–±–Ω–æ–≤–∏—Ç–µ `YOOKASSA_WEBHOOK_URL` –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω URL
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `YOOKASSA_TEST_MODE=false`
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–ª–∞—Ç–µ–∂–µ–π
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## ‚ùì –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook –≤ YooKassa
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É YooKassa

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [YooKassa API](https://yookassa.ru/developers/api)
- [YooKassa Webhook](https://yookassa.ru/developers/using-api/webhooks)
- [YooKassa –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](https://yookassa.ru/developers/using-api/testing)



